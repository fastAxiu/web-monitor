今天来聊聊WEB 监控工具中的UV 一般都是如何计算的，以及准确性如何。

第一种方法，通用性强、准确率低。用随机生成的UUID 来唯一标记一位用户，一旦生成，就存放在Cookie 中，设定一个比较长的过期时间，这样下次，用户再来的时候就会被识别为同一个用户。这种方式的问题就在于，用户一旦清除了Cookie，那么再次访问页面的时候就会标记为一个新的用户。既然如此，我们肯定希望这个UUID 尽量稳定，那么为什么不使用持久化存储LocalStorage 来代替Cookie 呢，因为Cookie 可以实现子域名间共享。

第二种方法与之类似，也是生成一个ID。但是不是随机生成，而是参考浏览器代理、屏幕色深、语言、插件安装、本地存储等信息生成一个指纹，比如FingerprintJS，据说指纹的准确率可以高达94%，但是在实践过程中发现很容易重复，不可取。

第三种方法，准确率较高，操作成本大。即给接入方提供一个API，让他们在用户登录后调用API 设置当前用户信息。因为业务侧拿到当前用户信息的时机不确定，所以会导致监控SDK 在一次访问的数据上报过程中出现UV 混乱的问题，有办法解决，但是会从一定程度上影响准确性。当然，相比于纯随机ID准确度还是会高很多。

第四种方法，准确率更高，操作成本更大。与接入服务的登录功能对接，用户每次来都精确的知道他是谁。以我们团队内部为例，公司大多数服务会走W3 统一登录，登录完成后，会在.huawei.com 这个域名下放置一个Cookie，Cookie 内容是编码后的用户工号。我们只要读到这个Cookie，上报到后端，解码出来，即可准确地识别出当前用户是谁。

第五种方法，准确性高，强纳管。公司内部确实有这样的工具。就是要求业务侧接入启动脚本时，必须传参告知当前的用户是谁，如果是游客就是用统一的字符串标记。这样对于内部产品来说，拿到的UV 是最准的。（其实这个方法跟第三种方法是同一类，只不过一个是推荐，一个是强制）

暂时就想到这么多，大家觉得还有其他方式来标记WEB 端UV 吗？

![012](./img/012.png)