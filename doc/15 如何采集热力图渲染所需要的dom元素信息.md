热力图是一种非常常见的，用于分析用户行为偏好的工具。常见的热力图一般有两种实施方案：

1、将页面截图上报作为背景，统计用户点击数据并计算偏移渲染热力

2、收集全量dom 元素上报、渲染作为背景，统计点击数据时收集元素xpath，通过xpath 寻找元素渲染热力

方案1 的好处在于，所有点击记录一定会呈现在最终渲染出的热力图上，问题是截图品质参差不齐，元素渲染位置不准确。页面截图可以使用html2canvas，热力渲染可以使用heatmap.js。

方案2 的好处在于渲染位置准确，但是会丢失信息，丢失的部分为在当前渲染出的页面上无法找到的元素。另外，dom 元素收集是方案中非常重要的一步。除了通过document.getElementsByTagName('html')[0].innerHTML 将dom 元素信息拿到手之外，还要做很多字符串处理工作，才能保证被渲染出来之后是一个正常的静态页面，要做的工作大概包含：

1、设置页面的base 保证页面上所有资源可用

2、disable 所有的script 和link，确保只渲染出一个静态页面

3、canvas 渲染出的图片需要截图保留

4、iframe 中的内容需要单独保留

5、input 等使用了shadowRoot 的内容需要单独设置

6、各种因为相对路径或者资源src 编码导致的资源加载失败问题处理

7、其他问题，需要通过失败的case 分析逐个解决